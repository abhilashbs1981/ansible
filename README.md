# ๐ Certificate Extraction Flow - Visual Representation

## ๐จ **VISUAL FLOW DIAGRAM**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                           ๐ STARTING POINT                                        
โ                                                                                     
โ  ๐ฅ JKS Files (Base64 Encoded)                                                    
โ  โโโโโโโโโโโโโโโโโโโโโโโ                    โโโโโโโโโโโโโโโโโโโโโโโ               
โ  โ ๐ TRUSTSTORE       โ                    โ ๐ KEYSTORE         โ               
โ  โ    .JKS             โ                    โ     .JKS            โ               
โ  โ                     โ                    โ                     โ               
โ  โ ๐ Root CA 1        โ                    โ ๐ค Client Cert      โ               
โ  โ ๐ Root CA 2        โ                    โ ๐ Private Key      โ               
โ  โ ๐ Root CA 3        โ                    โ                     โ               
โ  โโโโโโโโโโโโโโโโโโโโโโโ                    โโโโโโโโโโโโโโโโโโโโโโโ               
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                        โ
                                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        โ๏ธ  ANSIBLE PROCESSING                                      
โ                                                                                     
โ  ๐๏ธ  Create: {{ workdir }}/tmp/temp_certs/                                      
โ  ๐ Decode: Base64 โ Binary JKS files                                            
โ  ๐ Detect: Certificate aliases automatically                                    
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                        โ
                                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ CERTIFICATE EXTRACTION                                   
โ                                                                                     
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ  โ                    ๐๏ธ  TRUSTSTORE PROCESSING                                โ   
โ  โ                                                                             โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โ  โ ๐ Root CA1 โ    โ ๐ Root CA2 โ    โ ๐ Root CA3 โ                    โ   
โ  โ  โ             โ    โ             โ    โ             โ                    โ   
โ  โ  โ ๐ง keytool  โ    โ ๐ง keytool  โ    โ ๐ง keytool  โ                    โ   
โ  โ  โ -export     โ    โ -export     โ    โ -export     โ                    โ   
โ  โ  โ -rfc        โ    โ -rfc        โ    โ -rfc        โ                    โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โ           โ                       โ                       โ                โ   
โ  โ           โผ                       โผ                       โผ                โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โ  โ ๐ ca_cert1 โ    โ ๐ ca_cert2 โ    โ ๐ ca_cert3 โ                    โ   
โ  โ  โ   .pem      โ    โ   .pem      โ    โ   .pem      โ                    โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ  โ                    ๐ KEYSTORE PROCESSING                                    โ   
โ  โ                                                                             โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โ  โ ๐ JKSโPKCSโ    โ ๐ Extract  โ    โ ๐ Extract  โ                    โ   
โ  โ  โ   12        โ    โ   Client    โ    โ  Private    โ                    โ   
โ  โ  โ             โ    โ   Cert      โ    โ    Key      โ                    โ   
โ  โ  โ ๐ง keytool  โ    โ ๐ง keytool  โ    โ ๐ง openssl  โ                    โ   
โ  โ  โ -import     โ    โ -export     โ    โ  pkcs12     โ                    โ   
โ  โ  โ -keystore   โ    โ -rfc        โ    โ -nocerts    โ                    โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โ           โ                       โ                       โ                โ   
โ  โ           โผ                       โผ                       โผ                โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โ  โ ๐ฆ keystore โ    โ ๐ client   โ    โ ๐ client  โ                    โ   
โ  โ  โ   .p12      โ    โ   _cert.pem โ    โ   _key.pem  โ                    โ   
โ  โ  โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ                    โ   
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                        โ
                                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ฏ KUBERNETES SECRET                                        
โ                                                                                     
โ  ๐ Secret Name: kafka-soct-certs                                                  
โ  ๐ Namespace: observability                                                       
โ                                                                                     
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ           
โ  โ ๐ ca_cert1 โ  โ ๐ ca_cert2 โ  โ ๐ client  โ  โ ๐ client  โ           
โ  โ   .pem      โ  โ   .pem      โ  โ   _cert    โ  โ   _key     โ           
โ  โ (Base64)    โ  โ (Base64)    โ  โ   .pem     โ  โ   .pem     โ           
โ  โ             โ  โ             โ  โ (Base64)   โ  โ (Base64)   โ           
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ           
โ                                                                                     
โ  โโโโโโโโโโโโโโโ                                                                   
โ  โ ๐ client   โ                                                                   
โ  โ   _key_passโ                                                                   
โ  โ (Base64)   โ                                                                   
โ  โโโโโโโโโโโโโโโ                                                                   
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                                        โ
                                        โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐งน CLEANUP & OUTPUT                                         
โ                                                                                     
โ  ๐๏ธ  Remove: {{ workdir }}/tmp/temp_certs/                                       
โ  โ Secret: Ready for Fluentd configuration                                       
โ  ๐ SSL/TLS: Secure Kafka connection enabled                                      
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ง **COMMAND FLOW VISUAL**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ง COMMAND EXECUTION FLOW                                   
โ                                                                                     
โ  1๏ธโฃ  CREATE TEMP DIRECTORY                                                        
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ      โ mkdir -p {{ workdir }}/tmp/temp_certs/                                 โ   
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  2๏ธโฃ  DECODE JKS FILES                                                             
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ      โ echo "{{ values_nemoadapter_ossit_oceankafka_truststore }}" | base64 -d โ   
โ      โ echo "{{ values_nemoadapter_ossit_oceankafka_keystore }}" | base64 -d   โ   
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  3๏ธโฃ  LIST ALIASES                                                                 
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ      โ keytool -list -keystore truststore.jks -storepass <password>           โ   
โ      โ keytool -list -keystore keystore.jks -storepass <password>             โ   
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  4๏ธโฃ  EXTRACT CERTIFICATES                                                          
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ      โ keytool -exportcert -alias <alias> -file ca_cert_1.pem -rfc            โ   
โ      โ keytool -exportcert -alias <alias> -file ca_cert_2.pem -rfc            โ   
โ      โ keytool -exportcert -alias 1 -file client_cert.pem -rfc                โ   
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  5๏ธโฃ  CONVERT & EXTRACT PRIVATE KEY                                                
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ      โ keytool -importkeystore -srckeystore keystore.jks -destkeystore keystore.p12 โ   
โ      โ openssl pkcs12 -in keystore.p12 -out client_cert_key.pem -nocerts      โ   
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  6๏ธโฃ  CREATE KUBERNETES SECRET                                                    
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ      โ kubectl create secret generic kafka-soct-certs --from-file=ca_cert_1.pem โ   
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  7๏ธโฃ  CLEANUP                                                                      
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ      โ rm -rf {{ workdir }}/tmp/temp_certs/                                   โ   
โ      โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ **DATA TRANSFORMATION VISUAL**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ DATA TRANSFORMATION FLOW                                 
โ                                                                                     
โ  INPUT FORMAT                    PROCESSING                    OUTPUT FORMAT        
โ  โโโโโโโโโโโ                     โโโโโโโโโโโ                    โโโโโโโโโโโ         
โ                                                                                     
โ  ๐ TRUSTSTORE.JKS               ๐ keytool -export            ๐ ca_cert_1.pem     
โ  (Base64 String)                 (JKS โ PEM)                   (PEM Certificate)   
โ  โโโโโโโโโโโโโโโโโโโ             โโโโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ 
โ  โ ๐ Root CA 1    โ โโโโโโโโโโโถ โ ๐ง keytool      โ โโโโโโโโถ โ ๐ ca_cert_1    โ 
โ  โ ๐ Root CA 2    โ             โ -export -rfc    โ          โ   .pem          โ 
โ  โ ๐ Root CA 3    โ             โโโโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ 
โ  โโโโโโโโโโโโโโโโโโโ                                             ๐ ca_cert_2.pem 
โ                                                                  ๐ ca_cert_3.pem 
โ                                                                                     
โ  ๐ KEYSTORE.JKS                  ๐ JKS โ PKCS12 โ PEM        ๐ client_cert.pem  
โ  (Base64 String)                  (Multi-step conversion)      (PEM Certificate)   
โ  โโโโโโโโโโโโโโโโโโโ             โโโโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ 
โ  โ ๐ค Client Cert  โ โโโโโโโโโโโถ โ ๐ง keytool      โ โโโโโโโโถ โ ๐ client_cert  โ 
โ  โ ๐ Private Key  โ             โ -importkeystore โ          โ   .pem          โ 
โ  โโโโโโโโโโโโโโโโโโโ             โ ๐ง openssl      โ          โ ๐ client_cert  โ 
โ                                   โ pkcs12         โ          โ   _key.pem      โ 
โ                                   โโโโโโโโโโโโโโโโโโโ          โโโโโโโโโโโโโโโโโโโ 
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฏ **FINAL OUTPUT STRUCTURE**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ฏ KUBERNETES SECRET STRUCTURE                              
โ                                                                                     
โ  ๐ kafka-soct-certs (observability namespace)                                    
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ  โ                                                                             โ   
โ  โ  ๐ ca_cert_1.pem: "LS0tLS1CRUdJTi..." (Base64 encoded)                   โ   
โ  โ  ๐ ca_cert_2.pem: "LS0tLS1CRUdJTi..." (Base64 encoded)                   โ   
โ  โ  ๐ client_cert.pem: "LS0tLS1CRUdJTi..." (Base64 encoded)                 โ   
โ  โ  ๐ client_cert_key.pem: "LS0tLS1CRUdJTi..." (Base64 encoded)             โ   
โ  โ  ๐ client_cert_key_password: "cGFzc3dvcmQ=" (Base64 encoded)             โ   
โ  โ                                                                             โ   
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   
โ                                                                                     
โ  โ READY FOR FLUENTD CONFIGURATION                                               
โ  โ ENABLES SSL/TLS CONNECTION TO EXTERNAL KAFKA                                 
โ  โ AUTOMATIC JKS TO PEM CONVERSION                                               
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ **WHAT THIS ENABLES**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ SYSTEM BENEFITS                                          
โ                                                                                     
โ  ๐ SECURITY                    ๐ AUTOMATION                    ๐ MONITORING     
โ  โโโโโโโโโ                      โโโโโโโโโโโ                      โโโโโโโโโ         
โ                                                                                     
โ  โข SSL/TLS encryption          โข No manual certificate          โข Centralized      
โ  โข Secure Kafka connection     โข conversion needed              โข logging          
โ  โข Certificate validation      โข Automatic alias detection      โข Observability    
โ  โข Private key protection      โข Dynamic CA handling            โข Fluentd โ Kafka  
โ                                                                                     
โ  ๐ฏ DEPLOYMENT                 ๐งน MAINTENANCE                   ๐ง FLEXIBILITY     
โ  โโโโโโโโโโโ                   โโโโโโโโโโโ                      โโโโโโโโโ         
โ                                                                                     
โ  โข Kubernetes secret ready     โข Temporary file cleanup         โข Multiple CA      
โ  โข One-command deployment      โข No leftover files              โข support          
โ  โข Consistent configuration    โข Secure processing              โข JKS format       
โ  โข Environment agnostic        โข Password protection            โข input support    
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```
